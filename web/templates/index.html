<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LangExtract Runner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Highlight.js for code coloring (light/dark via media queries) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11/styles/github.min.css" media="(prefers-color-scheme: light)">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11/styles/github-dark.min.css" media="(prefers-color-scheme: dark)">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11/lib/common.min.js"></script>
    <!-- Marked for Markdown parsing and DOMPurify for sanitization -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
  </head>
  <body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100">
    <div class="max-w-8xl mx-auto p-6">
      <h1 class="text-2xl font-bold mb-4">LangExtract Workshop Runner</h1>
      <div id="app" class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Left: form + console + stats + files -->
        <div class="lg:col-span-7 space-y-4">
          <form id="run-form" class="space-y-4" enctype="multipart/form-data">
            <div>
              <label class="block text-sm font-medium mb-1">Model ID</label>
              <input name="MODEL_ID" id="MODEL_ID" class="w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700" placeholder="e.g. gpt-4o-mini" />
              <div id="model-badges" class="flex flex-wrap gap-2 mt-2"></div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Model Temperature</label>
                <input name="MODEL_TEMPERATURE" id="MODEL_TEMPERATURE" type="number" step="0.01" value="0.15" class="w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700" />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Max Norms per 5k</label>
                <input name="MAX_NORMS_PER_5K" id="MAX_NORMS_PER_5K" type="number" step="1" value="10" class="w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700" />
              </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Max Char Buffer</label>
                <input name="MAX_CHAR_BUFFER" id="MAX_CHAR_BUFFER" type="number" step="1" value="5000" class="w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700" />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Extraction Passes</label>
                <input name="EXTRACTION_PASSES" id="EXTRACTION_PASSES" type="number" step="1" value="2" class="w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700" />
              </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Prompt file</label>
                <select name="INPUT_PROMPTFILE" id="INPUT_PROMPTFILE" class="w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700"></select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Glossary file</label>
                <select name="INPUT_GLOSSARYFILE" id="INPUT_GLOSSARYFILE" class="w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700"></select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Examples file</label>
                <select name="INPUT_EXAMPLESFILE" id="INPUT_EXAMPLESFILE" class="w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700"></select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Semantics file</label>
                <select name="INPUT_SEMANTCSFILE" id="INPUT_SEMANTCSFILE" class="w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700"></select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Teach file</label>
                <select name="INPUT_TEACHFILE" id="INPUT_TEACHFILE" class="w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700"></select>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Input document (optional)</label>
              <input type="file" name="input_document" id="input_document" class="w-full text-gray-900 dark:text-gray-100" />
            </div>
            <div class="flex gap-3 items-center">
              <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded" type="submit">Start Run</button>
              <button id="cancel-run" type="button" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed" disabled>Cancel Run</button>
              <span id="run-id" class="text-sm text-gray-600 dark:text-gray-300"></span>
            </div>
            <p id="form-error" class="text-sm text-red-600"></p>
          </form>

          <div>
            <div class="flex items-center justify-between mb-2">
              <h2 class="text-lg font-semibold">Live Console</h2>
              <div class="flex items-center space-x-2 text-xs text-gray-500">
                <button id="console-settings" class="hover:text-gray-700 dark:hover:text-gray-300">
                  ‚öôÔ∏è
                </button>
                <span id="console-stats" class="bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded">
                  0 lines
                </span>
              </div>
            </div>
            <pre id="console" class="bg-black text-green-400 p-3 rounded h-64 overflow-auto"></pre>
          </div>

          <div>
            <h2 class="text-lg font-semibold mb-2">Stats</h2>
            <pre id="stats" class="bg-white border rounded p-3 h-40 overflow-auto dark:bg-gray-800 dark:border-gray-700"></pre>
          </div>
        </div>

        <!-- Right: preview (full-height sticky sidebar) -->
        <aside class="space-y-4 self-start lg:sticky lg:top-6 lg:col-span-5">
          <div class="w-full">
            <div class="flex items-center justify-between mb-2">
              <h2 class="text-lg font-semibold">Preview</h2>
              <div class="flex items-center space-x-2 text-xs text-gray-500">
                <button id="load-existing-run" class="hover:text-gray-700 dark:hover:text-gray-300" title="Load results from existing run">
                  üìÅ
                </button>
                <button id="preview-search" class="hover:text-gray-700 dark:hover:text-gray-300" title="Search in file">
                  üîç
                </button>
                <span id="preview-stats" class="bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded">
                  Ready
                </span>
              </div>
            </div>
            <div id="run-selector" class="mb-2 hidden">
              <select id="existing-runs" class="w-full text-xs border rounded px-2 py-1 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700">
                <option value="">Select a previous run...</option>
              </select>
            </div>
            <div id="file-badges" class="flex flex-wrap gap-2 mb-2"></div>
            <div id="preview" class="bg-white border rounded p-3 h-[calc(100vh-12rem)] min-h-[400px] overflow-auto dark:bg-gray-800 dark:border-gray-700"></div>
          </div>
        </aside>
      </div>
    </div>
    <script src="/static/console-optimizer.js"></script>
    <script src="/static/preview-optimizer.js"></script>
    <script src="/static/app.js"></script>
  </body>
</html>
